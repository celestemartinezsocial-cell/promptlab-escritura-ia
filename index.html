<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptLab Escritura con IA</title>
    
    <meta name="description" content="Herramienta educativa para aprender a escribir mejores prompts de IA. Crea, prueba y mejora tus prompts paso a paso.">
<meta name="keywords" content="prompt engineering, escritura con IA, prompts, inteligencia artificial, herramienta educativa">
    <meta name="google-site-verification" content="jXilcW0oFNZU2A9nywZ5AEey96xEW3dlBCsALlwqAsA" />
<meta property="og:title" content="PromptLab - Escritura con IA">
<meta property="og:description" content="Obt√©n mejores resultados de IA con prompts bien dise√±ados">
<meta property="og:image" content="https://i.imgur.com/KOEutOB.jpeg">
<meta property="og:url" content="https://promptlab-escritura-ia.vercel.app">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<link rel="canonical" href="https://promptlab-escritura-ia.vercel.app">

    <!-- Security: Pinned CDN versions to prevent supply-chain attacks -->
    <!-- TODO: Generate SRI hashes with: curl URL | openssl dgst -sha384 -binary | openssl base64 -A -->
    <!-- Then add integrity="sha384-HASH" to each script tag -->
    <script crossorigin="anonymous" src="https://unpkg.com/react@18.3.1/umd/react.production.min.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/@babel/standalone@7.26.4/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
   <!-- reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/api.js?render=6LdcKmgsAAAAAEEBeUlkq5FLYB_o9HNuEyrxNRMh"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: linear-gradient(to bottom right, #FFF5EE, #F5F5F5); min-height: 100vh; }
        .container { max-width: 1024px; margin: 0 auto; padding: 24px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); padding: 32px; margin-bottom: 24px; }
        .logo-container { display: flex; align-items: center; gap: 16px; margin-bottom: 8px; }
        .logo { height: 120px; width: auto; }
        .btn-primary { background: #FF7A00; color: white; padding: 16px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; width: 100%; font-size: 16px; }
        .btn-primary:hover:not(:disabled) { opacity: 0.9; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary { background: #E8E9E9; color: #4A4A4A; padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; }
        .input-field, .textarea-field, select { width: 100%; padding: 12px; border: 2px solid #E8E9E9; border-radius: 8px; font-size: 16px; font-family: 'Montserrat', sans-serif; }
        .input-field:focus, .textarea-field:focus, select:focus { outline: none; border-color: #FF7A00; }
        .textarea-field { min-height: 96px; resize: vertical; }
        .label { display: block; font-weight: 600; font-size: 16px; color: #374151; margin-bottom: 8px; }
        .helper-text { font-size: 14px; color: #8A8B8C; margin-top: 4px; }
        .content-btn { padding: 12px; border: 2px solid #E8E9E9; border-radius: 8px; background: white; cursor: pointer; text-align: center; }
        .content-btn.active { border-color: #FF7A00; background: #FFF5EE; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .space-y-4 > * + * { margin-top: 16px; }
        .space-y-6 > * + * { margin-top: 24px; }
        .alert { padding: 16px; border-left: 4px solid; border-radius: 8px; font-size: 16px; margin-bottom: 16px; }
        .alert-blue { background: #F3F4F6; border-color: #6B7280; color: #000000; }
        .alert-green { background: #F0FDF4; border-color: #22C55E; color: #166534; }
        .alert-orange { background: #FED7AA; border-color: #F59E0B; color: #000000; }
        .alert-purple { background: #FAF5FF; border-color: #A855F7; color: #6B21A8; }
        .alert-pink { background: #FCE7F3; border-color: #EC4899; color: #831843; }
        .copy-btn { position: relative; background: #FF7A00; color: white; padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s; }
        .copy-btn:hover { opacity: 0.9; }
        .copy-btn.copied { background: #22C55E; }
        .response-box { background: white; border: 1px solid #E8E9E9; border-radius: 8px; padding: 16px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; font-size: 16px; position: relative; }
        .step-indicator { width: 40px; height: 40px; min-width: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
        .progress-line { flex: 1; height: 4px; margin: 0 8px; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @media (max-width: 768px) { .grid-2, .grid-4 { grid-template-columns: 1fr; } .step-indicator { width: 32px; height: 32px; min-width: 32px; font-size: 12px; } .progress-line { margin: 0 4px; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <noscript>
  <h1>PromptLab - Escritura con IA</h1>
  <p>Herramienta educativa para aprender a crear mejores prompts de IA. Crea, prueba, mejora y compara tus prompts paso a paso para obtener mejores resultados.</p>
</noscript>
    <!-- Modal de Activaci√≥n Premium -->
<div class="modal fade" id="activate-modal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 12px;">
      <div class="modal-header" style="border: none; padding: 24px 24px 0;">
        <h5 class="modal-title" style="font-weight: 700; color: #FF7A00;">üéØ Activa tu Acceso Premium</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" style="padding: 24px;">
        <div id="activate-form-content">
          <p style="margin-bottom: 20px; color: #4A4A4A;">
            Ingresa el c√≥digo que recibiste al comprar el curso en Thinkific:
          </p>
          
          <form id="activate-form" onsubmit="handleActivatePremium(event)">
            <div style="margin-bottom: 16px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">
                C√≥digo Premium:
              </label>
              <input 
                type="text" 
                id="premium-code" 
                class="input-field"
                placeholder="PL-XXXXXXXXXX"
                required
                style="text-transform: uppercase;"
              />
            </div>

            <div id="activate-error" class="alert" style="background: #FEE2E2; border-left: 4px solid #EF4444; color: #991B1B; display: none; margin-bottom: 16px;">
            </div>

            <button type="submit" id="activate-submit" class="btn-primary">
              Activar Premium
            </button>
          </form>
        </div>

        <div id="activate-success" style="display: none; text-align: center; padding: 20px;">
          <div style="font-size: 48px; margin-bottom: 16px;">‚úÖ</div>
          <h5 style="color: #22C55E; margin-bottom: 8px;">¬°Premium Activado!</h5>
          <p style="color: #8A8B8C;">Recargando p√°gina...</p>
        </div>

        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #E8E9E9; text-align: center;">
          <p style="color: #8A8B8C; font-size: 14px; margin-bottom: 8px;">
            ¬øA√∫n no tienes un c√≥digo?
          </p>
          <a href="https://www.celestemartinez.net/courses/promptlab?coupon=UDE25" target="_blank" class="btn-secondary" style="display: inline-block; text-decoration: none;">
            Comprar Acceso Premium
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

    
    <script type="text/babel">
    const { useState } = React;

    const App = () => {
        const [step, setStep] = useState(0);
        const [data, setData] = useState({
            contentType: '',
            docSubtype: [],
            presentationSubtype: [],
            proposalSubtype: [],
            socialSubtype: '',
            topic: '',
            purpose: [],
            customPurpose: '',
            audience: '',
            tone: [],
            customTone: '',
            length: '',
            format: '',
            examples: '',
            constraints: '',
            keywords: '',
            additionalInstructions: ''
        });
        const [resp1, setResp1] = useState('');
        const [resp2, setResp2] = useState('');
        const [ref, setRef] = useState({ worked: '', notWorked: '', change: '' });
        const [finalRef, setFinalRef] = useState({
    betterPrompt: '',
    biggestChange: '',
    otherChange: '',
    keyInsight: ''
});
  const copyAllToClipboard = () => {
    const content = `
PROMPTLAB - ESCRITURA CON IA
=============================

PASO 1: CONFIGURACI√ìN
---------------------
Tipo de contenido: ${data.contentType}
Tema: ${data.topic}
Prop√≥sito: ${data.purpose.join(', ')}${data.customPurpose ? ` (${data.customPurpose})` : ''}
Audiencia: ${data.audience}
Tono: ${data.tone.join(', ')}${data.customTone ? ` (${data.customTone})` : ''}
${data.length ? `Extensi√≥n: ${data.length}` : ''}
${data.format ? `Formato: ${data.format}` : ''}
${data.examples ? `Ejemplos: ${data.examples}` : ''}
${data.constraints ? `Restricciones: ${data.constraints}` : ''}
${data.keywords ? `Palabras clave: ${data.keywords}` : ''}
${data.additionalInstructions ? `Instrucciones adicionales: ${data.additionalInstructions}` : ''}

PASO 2: PROMPT INICIAL
-----------------------
${buildPrompt()}

RESPUESTA DE LA IA:
${resp1 || '(No generada a√∫n)'}

PASO 3: AN√ÅLISIS
-----------------
‚úÖ ¬øQu√© funcion√≥ bien?: ${ref.worked || '(Sin completar)'}
‚ùå ¬øQu√© no funcion√≥?: ${ref.notWorked || '(Sin completar)'}
üîß ¬øQu√© cambiar√°s?: ${ref.change || '(Sin completar)'}

PASO 4: PROMPT MEJORADO
------------------------
${resp2 ? buildPrompt() : '(No generado a√∫n)'}

RESPUESTA DE LA IA MEJORADA:
${resp2 || '(No generada a√∫n)'}

REFLEXI√ìN FINAL
---------------
‚úì Prompt que mejor logr√≥ mi prop√≥sito: ${
    finalRef.betterPrompt === 'inicial' ? 'Prompt Inicial' : 
    finalRef.betterPrompt === 'mejorado' ? 'Prompt Mejorado' : 
    '(Sin seleccionar)'
}

‚úì Cambio que hizo la mayor diferencia: ${
    finalRef.biggestChange === 'otro' ? finalRef.otherChange : 
    finalRef.biggestChange === 'contexto' ? 'Ser m√°s espec√≠fico con el contexto' :
    finalRef.biggestChange === 'instrucciones' ? 'Mejorar las instrucciones' :
    finalRef.biggestChange === 'tono' ? 'Ajustar el tono' :
    finalRef.biggestChange === 'ejemplos' ? 'Dar ejemplos concretos' :
    '(Sin seleccionar)'
}

üí° Insight clave: ${finalRef.keyInsight || '(Sin completar)'}

---
Generado con PromptLab - Escritura con IA
${new Date().toLocaleDateString('es-ES')}
`;

    navigator.clipboard.writeText(content).then(() => {
        alert('‚úÖ Todo el contenido copiado al portapapeles');
    }).catch(err => {
        console.error('Error al copiar:', err);
        alert('‚ùå No se pudo copiar. Intenta de nuevo.');
    });
};
        const [loading, setLoading] = useState(false);

        const types = [
            { id: 'email', label: 'Correo electr√≥nico/Mensaje', emoji: 'üìß' },
            { id: 'report', label: 'Informe', emoji: 'üìä' },
            { id: 'presentation', label: 'Presentaci√≥n', emoji: 'üìΩÔ∏è', hasSubtypes: true },
            { id: 'proposal', label: 'Propuesta', emoji: 'üíº', hasSubtypes: true },
            { id: 'documentation', label: 'Documento', emoji: 'üìù', hasSubtypes: true },
            { id: 'article', label: 'Art√≠culo/Blog', emoji: '‚úçÔ∏è' },
            { id: 'article', label: 'Ensayo', emoji: '‚úçÔ∏è' },
            { id: 'social', label: 'Redes Sociales', emoji: 'üì±', hasSubtypes: true }
        ];

        const docSubtypes = [
            'Manual de Usuario',
            'Gu√≠a T√©cnica',
            'Procedimiento (SOP)',
            'Pol√≠tica Interna',
            'Resumen Ejecutivo'
        ];

        const presentationSubtypes = [
            'Pitch Deck',
            'Training',
            'Informe Ejecutivo',
            'Reuni√≥n de Equipo',
            'Webinar'
        ];

        const proposalSubtypes = [
            'Comercial',
            'Proyecto',
            'Presupuesto',
            'Colaboraci√≥n',
            'Auspicio'
        ];

        const socialSubtypes = {
            'Facebook': 'En Facebook, prioriza un tono conversacional que fomente la conexi√≥n personal y el sentido de comunidad. Evita estructuras que parezcan anuncios publicitarios directos; en su lugar, enf√≥cate en contar una historia o compartir valor de forma genuina.',
            'Instagram': 'En Instagram, el contenido debe ser visualmente descriptivo y directo. Prioriza un inicio impactante (gancho) y utiliza p√°rrafos muy cortos o listas. La IA debe entender que el texto acompa√±a a una imagen o video, por lo que debe ser est√©tico y f√°cil de leer de un vistazo.',
            'LinkedIn': 'En LinkedIn, el tono debe ser profesional pero humano (aut√©ntico). El enfoque debe estar en compartir una lecci√≥n aprendida, un dato relevante o una reflexi√≥n de valor para la industria. Evita el lenguaje demasiado informal o "clich√©"; busca que el autor suene como un experto confiable.',
            'TikTok': 'Para TikTok, el texto debe funcionar como un guion de ritmo r√°pido. La instrucci√≥n es ser extremadamente conciso, usar un lenguaje coloquial y din√°mico. La IA debe enfocarse en entregar la informaci√≥n m√°s importante de inmediato para evitar que el usuario deslice hacia abajo.'
        };

        const purposes = [
            'Informar/Educar', 'Persuadir/Convencer', 'Inspirar/Motivar',
            'Anunciar/Actualizar', 'Solicitar/Proponer', 'Documentar/Registrar',
            'Entretener', 'Vender/Promocionar', 'Explicar un proceso',
            'Otro'
        ];

        const tones = [
            'Profesional', 'Casual/Conversacional', 'Formal',
            'Amigable', 'Autoritario', 'Emp√°tico',
            'Humor√≠stico', 'Inspirador', 'Directo/Conciso',
            'T√©cnico', 'Cercano', 'Otro'
        ];

        const steps = ['Crear', 'Probar & Analizar', 'Mejorar', 'Comparar & Aprender'];
        const quickStartTemplates = [
    {
        label: 'Email de ventas',
        emoji: 'üìß',
        data: { contentType: 'email', purpose: ['Vender/Promocionar'], tone: ['Profesional'] }
    },
    {
        label: 'Post de LinkedIn',
        emoji: 'üíº',
        data: { contentType: 'social', socialSubtype: 'LinkedIn', purpose: ['Informar/Educar'], tone: ['Profesional'] }
    },
    {
        label: 'Propuesta comercial',
        emoji: 'üìã',
        data: { contentType: 'proposal', proposalSubtype: ['Comercial'], purpose: ['Persuadir/Convencer'], tone: ['Formal'] }
    },
    {
        label: 'Art√≠culo de blog',
        emoji: '‚úçÔ∏è',
        data: { contentType: 'article', purpose: ['Informar/Educar'], tone: ['Casual/Conversacional'] }
    }
];


        const update = (k, v) => {
            setData(prev => {
                const newData = { ...prev, [k]: v };
                if (k === 'contentType') {
                    newData.docSubtype = [];
                    newData.presentationSubtype = [];
                    newData.proposalSubtype = [];
                    newData.socialSubtype = '';
                }
                return newData;
            });
        };
        // Auto-llenar instrucciones adicionales con el plan de mejora

        const toggleMulti = (field, value) => {
            setData(prev => {
                const current = prev[field] || [];
                const updated = current.includes(value)
                    ? current.filter(v => v !== value)
                    : [...current, value];
                return { ...prev, [field]: updated };
            });
        };

        const getPromptQuality = () => {
            const requiredFilled = data.contentType && data.topic && data.audience
                && data.purpose.length > 0 && data.tone.length > 0;
            const filledRequired = requiredFilled ? 5 : [data.contentType, data.topic, data.audience, data.purpose.length > 0, data.tone.length > 0].filter(Boolean).length;
            const optionalFields = ['length', 'keywords', 'additionalInstructions'];
            const filledOptional = optionalFields.filter(f => data[f]).length;
            
            const needsSubtype = data.contentType === 'documentation' || 
                                 data.contentType === 'presentation' || 
                                 data.contentType === 'proposal' || 
                                 data.contentType === 'social';
            
            const hasSubtype = data.docSubtype.length > 0 || data.presentationSubtype.length > 0 || data.proposalSubtype.length > 0 || data.socialSubtype;
            
            if (filledRequired === 5 && (!needsSubtype || hasSubtype) && filledOptional >= 2) {
                return { emoji: 'üü¢', text: 'Excelente', color: '#22C55E' };
            } else if (filledRequired === 5 && (!needsSubtype || hasSubtype)) {
                return { emoji: 'üü°', text: 'Bueno', color: '#F59E0B' };
            } else {
                return { emoji: 'üî¥', text: 'Necesita m√°s detalles', color: '#EF4444' };
            }
        };

        const buildPrompt = () => {
            let p = '';
            let typeLabel = '';
            
            if (data.contentType) {
                const t = types.find(x => x.id === data.contentType);
                
                if (data.contentType === 'documentation' && data.docSubtype.length > 0) {
                    typeLabel = data.docSubtype.join(', ');
                } else if (data.contentType === 'presentation' && data.presentationSubtype.length > 0) {
                    typeLabel = data.presentationSubtype.join(', ');
                } else if (data.contentType === 'proposal' && data.proposalSubtype.length > 0) {
                    typeLabel = data.proposalSubtype.join(', ');
                } else if (data.contentType === 'social' && data.socialSubtype) {
                    typeLabel = `publicaci√≥n para ${data.socialSubtype}`;
                } else {
                    typeLabel = t.label.toLowerCase();
                }
                
                p = `Escribe ${typeLabel}`;
            }
            
            if (data.topic) p += ` sobre ${data.topic}`;
            p += '.';
            
            if (data.contentType === 'social' && data.socialSubtype) {
                p += `\n\nIMPORTANTE - Best Practice de ${data.socialSubtype}:\n${socialSubtypes[data.socialSubtype]}`;
            }
            
            const d = [];
            const purposeList = [...(data.purpose || [])];
            if (purposeList.includes('Otro') && data.customPurpose) {
                purposeList[purposeList.indexOf('Otro')] = data.customPurpose;
            } else {
                const otroIdx = purposeList.indexOf('Otro');
                if (otroIdx > -1 && !data.customPurpose) purposeList.splice(otroIdx, 1);
            }
            if (purposeList.length > 0) d.push(`Prop√≥sito: ${purposeList.join(', ')}`);
            if (data.audience) d.push(`Audiencia: ${data.audience}`);
            const toneList = [...(data.tone || [])];
            if (toneList.includes('Otro') && data.customTone) {
                toneList[toneList.indexOf('Otro')] = data.customTone;
            } else {
                const otroIdx = toneList.indexOf('Otro');
                if (otroIdx > -1 && !data.customTone) toneList.splice(otroIdx, 1);
            }
            if (toneList.length > 0) d.push(`Tono: ${toneList.join(', ')}`);
            if (data.length) d.push(`Extensi√≥n: ${data.length}`);
            if (d.length > 0) p += '\n\n' + d.join('\n');
            
            if (data.format) p += `\n\nFormato: ${data.format}`;
            if (data.examples) p += `\n\nEstilo: ${data.examples}`;
            if (data.constraints) p += `\n\nRequisitos: ${data.constraints}`;
            if (data.keywords) p += `\n\nPalabras clave a incluir obligatoriamente: ${data.keywords}`;
            if (data.additionalInstructions) p += `\n\nInstrucciones adicionales: ${data.additionalInstructions}`;
            p += `\n\n[ESTILO CR√çTICO]: S√© directo y aut√©ntico. NO uses frases clich√© como "en el mundo de hoy", "es fundamental", "cabe destacar". NO uses lenguaje corporativo vac√≠o. Escribe como un humano real, no como un robot. Prioriza claridad sobre elegancia.\n\n[PRECISI√ìN]: Basa tu contenido √öNICAMENTE en la informaci√≥n proporcionada en este prompt. NO inventes datos, estad√≠sticas, cifras, nombres de estudios o hechos que no se hayan mencionado expl√≠citamente. Si necesitas dar ejemplos, se√±√°lalos claramente como hipot√©ticos. Prefiere decir "seg√∫n los datos disponibles" en lugar de inventar fuentes. NUNCA hagas suposiciones sobre datos espec√≠ficos del usuario.`;
            
            return p.trim();
        };

const generate = async (isRevised) => {
    setLoading(true);
    // Block non-premium users
    const tier = window.promptLabLimits ? window.promptLabLimits.getUserTier() : 'anonymous';
    if (tier !== 'premium') {
        const errorMsg = 'üîí Necesitas un c√≥digo premium para usar esta herramienta. Adqui√©relo en Thinkific.';
        isRevised ? setResp2(errorMsg) : setResp1(errorMsg);
        setLoading(false);
        return;
    }
    try {
        let requestBody;
        
        if (isRevised && resp1) {
            // Enviar conversaci√≥n con memoria real
            const currentPrompt = buildPrompt();
            const improvementPlan = ref.change || 'Mejorar el contenido seg√∫n los ajustes en el prompt';
            
            requestBody = {
                messages: [
                    { 
                        role: "user", 
                        content: buildPrompt() // El prompt original que gener√≥ resp1
                    },
                    { 
                        role: "assistant", 
                        content: resp1 
                    },
                    {
                        role: "user",
                        content: `Necesito una versi√≥n NOTABLEMENTE DIFERENTE y MEJORADA del contenido anterior.

üìù Plan de mejora del usuario: ${improvementPlan}

üéØ Prompt actualizado:
${currentPrompt}

INSTRUCCIONES PARA LA VERSI√ìN MEJORADA:
1. REESCRIBE el contenido desde una perspectiva fresca - NO copies frases ni p√°rrafos del texto anterior
2. APLICA los cambios solicitados de forma visible y sustancial
3. USA una estructura diferente: si antes usaste p√°rrafos, prueba con listas; si usaste introducci√≥n larga, ve directo al punto
4. CAMBIA las frases de apertura y cierre completamente - deben ser distintas a la versi√≥n anterior
5. MANT√âN el mismo tema y prop√≥sito, pero expr√©salo de forma diferente
6. Si el usuario pidi√≥ cambio de tono, el cambio debe ser evidente en cada p√°rrafo
7. NO repitas las mismas oraciones con sin√≥nimos - genera ideas y enfoques nuevos
8. Basa el contenido SOLO en informaci√≥n proporcionada - NO inventes datos ni estad√≠sticas`
                    }
                ]
            };
        } else {
            // Primera generaci√≥n sin memoria
            requestBody = {
                prompt: buildPrompt()
            };
        }
        
        const fetchHeaders = {
            "Content-Type": "application/json",
            "X-Tier": window.promptLabLimits ? window.promptLabLimits.getUserTier() : "anonymous"
        };
        // Send server-issued premium token if available
        if (window.promptLabLimits && window.promptLabLimits.getPremiumToken()) {
            fetchHeaders["X-Premium-Token"] = window.promptLabLimits.getPremiumToken();
        }
        }
        
        // Obtener token de reCAPTCHA v3
        const recaptchaToken = await new Promise((resolve) => {
            grecaptcha.ready(() => {
                grecaptcha.execute('6LdcKmgsAAAAAEEBeUlkq5FLYB_o9HNuEyrxNRMh', { action: 'generate' })
                    .then(resolve);
            });
        });
        
        // Agregar token a headers
        fetchHeaders['X-Recaptcha-Token'] = recaptchaToken;
        
        const res = await fetch("/api/generate", {
            method: "POST",
            headers: fetchHeaders,
            body: JSON.stringify(requestBody)
        });
        
        if (!res.ok) {
            const errorData = await res.json();
            throw new Error(errorData.error || `Error ${res.status}`);
        }
        
        const json = await res.json();
        const text = json.text || "";
        
        if (!text) {
            throw new Error("No se recibi√≥ contenido");
        }
        
        isRevised ? setResp2(text) : setResp1(text);
        
    } catch (e) {
        console.error('Error:', e);
        const errorMsg = `‚ùå Error: ${e.message}`;
        isRevised ? setResp2(errorMsg) : setResp1(errorMsg);
    } finally {
        setLoading(false);
    }
};
     
        const [copyStatus, setCopyStatus] = useState({});
        const copy = (text, id) => {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    setCopyStatus(prev => ({...prev, [id]: true}));
                    setTimeout(() => setCopyStatus(prev => ({...prev, [id]: false})), 2000);
                }).catch(() => {
                    // Fallback for older browsers
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    textarea.style.position = 'fixed';
                    textarea.style.opacity = '0';
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    setCopyStatus(prev => ({...prev, [id]: true}));
                    setTimeout(() => setCopyStatus(prev => ({...prev, [id]: false})), 2000);
                });
            }
        };

        const CopyButton = ({text, id, large}) => (
            <button
                onClick={() => copy(text, id)}
                className={`copy-btn ${copyStatus[id] ? 'copied' : ''}`}
                style={large ? {padding: '12px 24px', fontSize: '16px', width: '100%'} : {}}
            >
                {copyStatus[id] ? '‚úì Copiado' : 'üìã Copiar'}
            </button>
        );

     const exportData = () => {
    try {
        const content = `PROYECTO PROMPTLAB\n\nPROMPT INICIAL:\n${buildPrompt()}\n\nRESPUESTA 1:\n${resp1}\n\nREFLEXI√ìN:\n${ref.worked}\n${ref.notWorked}\n${ref.change}\n\nPROMPT MEJORADO:\n${buildPrompt()}\n\nRESPUESTA 2:\n${resp2}\n\nAPRENDIZAJES:\n${finalRef.learning}`;
        
        // Detectar iOS espec√≠ficamente
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        
        if (isIOS || isAndroid) {
            // En m√≥vil: copiar al portapapeles
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(content).then(() => {
                    alert('‚úì Contenido copiado al portapapeles.\n\nAhora:\n1. Abre Notes, Gmail, o Google Drive\n2. Pega el contenido (mant√©n presionado y selecciona "Pegar")\n3. Guarda como archivo');
                }).catch(() => {
                    // Fallback: crear textarea para copiar manualmente
                    const textarea = document.createElement('textarea');
                    textarea.value = content;
                    textarea.style.position = 'fixed';
                    textarea.style.opacity = '0';
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert('‚úì Contenido copiado.\n\nAbre Notes o cualquier app de texto y pega (mant√©n presionado).');
                });
            } else {
                // M√©todo alternativo para navegadores antiguos
                const textarea = document.createElement('textarea');
                textarea.value = content;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('‚úì Contenido copiado.\n\nAbre Notes o cualquier app de texto y pega.');
            }
        } else {
            // En escritorio: descarga normal
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'promptlab-proyecto.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('‚úì Archivo descargado. Revisa tu carpeta de Descargas.');
        }
    } catch (error) {
        console.error('Error al exportar:', error);
        alert('‚ùå Error al exportar. Por favor, toma screenshot del contenido.');
    }
};

const exportToWord = () => {
    try {
        // Detectar iOS espec√≠ficamente
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);

        if (isIOS || isAndroid) {
            // En m√≥vil: mostrar mensaje e invitar a usar TXT
            alert('En moviles, es mas facil usar "Exportar TXT".\n\nOpciones:\n1. Usa el boton "Exportar TXT" (recomendado)\n2. O exporta desde una computadora para obtener formato Word');
            return;
        }

        // Security: Sanitize content before inserting into HTML to prevent XSS
        const sanitizeHTML = (str) => {
            if (!str) return '';
            return str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;')
                .replace(/\n/g, '<br>');
        };

        // En escritorio: descarga Word normal
        const content = `
<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'>
<head>
    <meta charset='utf-8'>
    <title>PromptLab Export</title>
</head>
<body>
    <h1>PromptLab - Proyecto</h1>
    <h2>Prompt Inicial</h2>
    <p>${sanitizeHTML(buildPrompt())}</p>
    <h2>Primera Version</h2>
    <p>${sanitizeHTML(resp1)}</p>
    ${resp2 ? `<h2>Version Mejorada</h2><p>${sanitizeHTML(resp2)}</p>` : ''}
    <h2>Aprendizajes</h2>
    <p>${sanitizeHTML(finalRef.learning) || 'Sin aprendizajes registrados'}</p>
</body>
</html>`;
        
        const blob = new Blob(['\ufeff', content], { type: 'application/msword' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'promptlab-proyecto.doc';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        alert('‚úì Documento descargado. Revisa tu carpeta de Descargas.');
    } catch (error) {
        console.error('Error al exportar Word:', error);
        alert('‚ùå Error al exportar. Intenta con el bot√≥n "Exportar TXT".');
    }
};
        return (
            <div className="container">
                <div className="card">
                    <div className="logo-container">
                        <img
                            src="https://i.imgur.com/KOEutOB.jpeg"
                            alt="Logo"
                            style={{height: '138px', width: 'auto'}}
                        />
                        <div>
                            <h1 style={{fontSize: '30px', fontWeight: 700, color: '#000000', marginBottom: '4px'}}>
                                PromptLab Escritura con IA
                            </h1>
                            <p style={{color: '#8A8B8C', fontWeight: 700}}>Obt√©n mejores resultados de IA con prompts bien dise√±ados</p>
                        </div>
                    </div>
                    </div>
                </div>  
               <div style={{textAlign: 'center', marginBottom: '16px'}}>
                <button 
                    onClick={() => openActivateModal()} 
                    className="btn-secondary"
                    style={{display: 'inline-block', padding: '12px 32px'}}
                >
                    üîë Activar C√≥digo Premium
                </button>
            </div>

                <div className="card">
                    <div style={{display: 'flex', alignItems: 'flex-start', justifyContent: 'space-between'}}>
                        {steps.map((label, i) => (
                            <React.Fragment key={i}>
                                <div style={{display: 'flex', flexDirection: 'column', alignItems: 'center', width: '70px'}}>
                                    <div className="step-indicator" style={{
                                        backgroundColor: i === step ? '#FF7A00' : i < step ? '#FFA347' : '#E8E9E9',
                                        color: i <= step ? 'white' : '#9CA3AF'
                                    }}>
                                        {i + 1}
                                    </div>
                                    <div style={{
                                        fontSize: '11px', marginTop: '4px', textAlign: 'center',
                                        fontWeight: i === step ? 600 : 400, lineHeight: '1.2',
                                        color: i === step ? '#FF7A00' : '#8A8B8C'
                                    }}>
                                        {label}
                                    </div>
                                </div>
                                {i < 3 && <div className="progress-line" style={{
                                    backgroundColor: i < step ? '#FFA347' : '#E8E9E9',
                                    marginTop: '18px'
                                }} />}
                            </React.Fragment>
                        ))}
                    </div>
                </div>

                <div className="card">
                    {step === 0 && (
                        <div className="space-y-6">
                            <div className="alert alert-blue">
                                <strong>üéØ Paso 1: Crea tu Prompt</strong><br/><br/>
                                Un buen prompt es espec√≠fico y claro. Completa estos campos para que la IA entienda exactamente qu√© necesitas. Mientras m√°s detalles des, mejores ser√°n los resultados.
                            </div>
<div style={{background: '#FFF7ED', padding: '16px', borderRadius: '8px', border: '1px solid #FED7AA'}}>
    <p style={{fontSize: '14px', fontWeight: 600, marginBottom: '12px', color: '#92400E'}}>
        ¬øNo sabes por d√≥nde empezar? Elige una plantilla:
    </p>
    <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px'}}>
        {quickStartTemplates.map(t => (
            <button key={t.label}
                onClick={() => setData(prev => ({...prev, ...t.data}))}
                className="content-btn"
                style={{padding: '8px 14px', fontSize: '13px', flex: 'none'}}>
                {t.emoji} {t.label}
            </button>
        ))}
    </div>
</div>

                            <div>
                                <label className="label">1. Tipo de Contenido *</label>
                                <div className="grid-4">
                                    {types.map(t => (
                                        <button key={t.id} onClick={() => update('contentType', t.id)}
                                            className={`content-btn ${data.contentType === t.id ? 'active' : ''}`}>
                                            <div style={{fontSize: '24px', marginBottom: '4px'}}>{t.emoji}</div>
                                            <div style={{fontSize: '12px', fontWeight: 500}}>{t.label}</div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {data.contentType === 'documentation' && (
                                <div>
                                    <label className="label">Tipo de Documento * <span style={{fontSize: '12px', fontWeight: 400, color: '#8A8B8C'}}>(puedes elegir varios)</span></label>
                                    <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px'}}>
                                        {docSubtypes.map(st => (
                                            <button key={st} onClick={() => toggleMulti('docSubtype', st)}
                                                className={`content-btn ${data.docSubtype.includes(st) ? 'active' : ''}`}
                                                style={{padding: '8px 14px', fontSize: '13px', flex: 'none'}}>
                                                {st}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {data.contentType === 'presentation' && (
                                <div>
                                    <label className="label">Tipo de Presentaci√≥n * <span style={{fontSize: '12px', fontWeight: 400, color: '#8A8B8C'}}>(puedes elegir varios)</span></label>
                                    <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px'}}>
                                        {presentationSubtypes.map(st => (
                                            <button key={st} onClick={() => toggleMulti('presentationSubtype', st)}
                                                className={`content-btn ${data.presentationSubtype.includes(st) ? 'active' : ''}`}
                                                style={{padding: '8px 14px', fontSize: '13px', flex: 'none'}}>
                                                {st}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {data.contentType === 'proposal' && (
                                <div>
                                    <label className="label">Tipo de Propuesta * <span style={{fontSize: '12px', fontWeight: 400, color: '#8A8B8C'}}>(puedes elegir varios)</span></label>
                                    <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px'}}>
                                        {proposalSubtypes.map(st => (
                                            <button key={st} onClick={() => toggleMulti('proposalSubtype', st)}
                                                className={`content-btn ${data.proposalSubtype.includes(st) ? 'active' : ''}`}
                                                style={{padding: '8px 14px', fontSize: '13px', flex: 'none'}}>
                                                {st}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {data.contentType === 'social' && (
                                <div>
                                    <label className="label">Red Social *</label>
                                    <select value={data.socialSubtype} onChange={(e) => update('socialSubtype', e.target.value)} className="input-field">
                                        <option value="">Seleccionar red social...</option>
                                        {Object.keys(socialSubtypes).map(sn => <option key={sn} value={sn}>{sn}</option>)}
                                    </select>
                                    {data.socialSubtype && (
                                        <div style={{background: '#FFF7ED', border: '1px solid #FED7AA', borderRadius: '8px', padding: '12px', marginTop: '8px'}}>
                                            <p style={{fontSize: '12px', color: '#92400E'}}>
                                                <strong>üìå Best Practice:</strong> {socialSubtypes[data.socialSubtype]}
                                            </p>
                                        </div>
                                    )}
                                </div>
                            )}

                            <div>
                                <label className="label">2. ¬øSobre qu√© est√°s escribiendo? *</label>
                                <input type="text" value={data.topic} onChange={(e) => update('topic', e.target.value)}
                                    placeholder="Ej: El impacto del trabajo remoto en equipos de desarrollo"
                                    maxLength={200}
                                    className="input-field" />
                                <p className="helper-text">Mientras m√°s espec√≠fico, mejores resultados</p>
                            </div>

                            <div>
                                <label className="label">3. Prop√≥sito * <span style={{fontSize: '12px', fontWeight: 400, color: '#8A8B8C'}}>(puedes elegir varios)</span></label>
                                <div style={{background: '#F9FAFB', padding: '12px', borderRadius: '8px'}}>
                                    <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px'}}>
                                        {purposes.map(p => (
                                            <button key={p} onClick={() => toggleMulti('purpose', p)}
                                                className={`content-btn ${data.purpose.includes(p) ? 'active' : ''}`}
                                                style={{padding: '8px 14px', fontSize: '13px', flex: 'none'}}>
                                                {p}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                {data.purpose.includes('Otro') && (
                                    <input type="text" value={data.customPurpose || ''} onChange={(e) => update('customPurpose', e.target.value)}
                                        placeholder="Escribe tu prop√≥sito..." maxLength={100}
                                        className="input-field" style={{marginTop: '8px'}} />
                                )}
                            </div>

                            <div>
                                <label className="label">4. Tono * <span style={{fontSize: '12px', fontWeight: 400, color: '#8A8B8C'}}>(puedes elegir varios)</span></label>
                                <div style={{background: '#F9FAFB', padding: '12px', borderRadius: '8px'}}>
                                    <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px'}}>
                                        {tones.map(t => (
                                            <button key={t} onClick={() => toggleMulti('tone', t)}
                                                className={`content-btn ${data.tone.includes(t) ? 'active' : ''}`}
                                                style={{padding: '8px 14px', fontSize: '13px', flex: 'none'}}>
                                                {t}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                {data.tone.includes('Otro') && (
                                    <input type="text" value={data.customTone || ''} onChange={(e) => update('customTone', e.target.value)}
                                        placeholder="Escribe tu tono..." maxLength={100}
                                        className="input-field" style={{marginTop: '8px'}} />
                                )}
                            </div>

                           <div className="grid-2">
    <div>                
   <label className="label">5. Audiencia *</label>
    <input type="text" value={data.audience} onChange={(e) => update('audience', e.target.value)}
        placeholder="Ej: Profesionales 35-50 a√±os, gerentes de marketing, con experiencia b√°sica en IA, buscan soluciones pr√°cticas sin tecnicismos"
        maxLength={500}
        className="input-field" />
    <div style={{background: '#F0F9FF', padding: '12px', borderRadius: '8px', border: '1px solid #BFDBFE', marginTop: '8px'}}>
                                        <p style={{fontSize: '13px', color: '#1E40AF', margin: 0}}>
                                            <strong>üí° Mientras m√°s detalles, mejor:</strong>
                                        </p>
                                        <p style={{fontSize: '12px', color: '#1E3A8A', margin: '8px 0 0 0', lineHeight: '1.6'}}>
                                            ‚Ä¢ <strong>Demogr√°ficos:</strong> edad, ubicaci√≥n, profesi√≥n, industria
                                            <br/>
                                            ‚Ä¢ <strong>Comportamiento:</strong> nivel de experiencia, h√°bitos de consumo de contenido
                                            <br/>
                                            ‚Ä¢ <strong>Necesidades:</strong> qu√© buscan, qu√© problemas tienen, qu√© valoran
                                            <br/>
                                            ‚Ä¢ <strong>Comunicaci√≥n:</strong> prefieren lenguaje t√©cnico o simple, formal o casual
                                        </p>
                                    </div>
        </div>
                                <div>
                                    <label className="label" style={{color: '#8A8B8C'}}>6. Extensi√≥n <span style={{fontSize: '12px', fontWeight: 400}}>(opcional)</span></label>
                                    <select value={data.length} onChange={(e) => update('length', e.target.value)} className="input-field">
                                        <option value="">Seleccionar extensi√≥n...</option>
                                        <option value="~100 palabras">Muy corto (~100 palabras)</option>
                                        <option value="~250 palabras">Corto (~250 palabras)</option>
                                        <option value="~500 palabras">Medio (~500 palabras)</option>
                                        <option value="~1000 palabras">Largo (~1000 palabras)</option>
                                        <option value="~2000 palabras">Muy largo (~2000 palabras)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style={{borderTop: '2px solid #FF7A00', paddingTop: '24px'}}>
                                <button
                                    onClick={() => setData(prev => ({...prev, _showDetails: !prev._showDetails}))}
                                    style={{background: 'none', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px', padding: 0, width: '100%'}}
                                >
                                    <h3 style={{fontSize: '18px', fontWeight: 700, margin: 0}}>
                                        üìã Detalles Opcionales
                                    </h3>
                                    <span style={{fontSize: '14px', color: '#8A8B8C'}}>
                                        {data._showDetails ? '‚ñ≤ Ocultar' : '‚ñº Mostrar m√°s opciones'}
                                    </span>
                                </button>

                                {data._showDetails && (
                                    <div className="space-y-4" style={{marginTop: '16px'}}>
                                        <div>
                                            <label className="label" style={{color: '#8A8B8C'}}>7. Palabras clave <span style={{fontSize: '12px', fontWeight: 400}}>(opcional)</span></label>
                                            <input
                                                type="text"
                                                value={data.keywords || ''}
                                                onChange={(e) => update('keywords', e.target.value)}
                                                className="input-field"
                                                maxLength={300}
                                                placeholder="Ej: innovaci√≥n, sostenibilidad, ROI, transformaci√≥n digital"
                                            />
                                            <p className="helper-text">Palabras que DEBEN aparecer en el contenido</p>
                                        </div>

                                        <div>
                                            <label className="label" style={{color: '#8A8B8C'}}>8. Instrucciones adicionales <span style={{fontSize: '12px', fontWeight: 400}}>(opcional)</span></label>
                                            <textarea
                                                value={data.additionalInstructions || ''}
                                                onChange={(e) => update('additionalInstructions', e.target.value)}
                                                className="textarea-field"
                                                maxLength={1000}
                                                placeholder="Ej: Formato con bullets, estilo como NYTimes, incluir 3 CTAs, usar datos del Q4, evitar jerga t√©cnica..."
                                                rows="2"
                                            />
                                            <p className="helper-text">Detalles espec√≠ficos √∫nicos de esta tarea</p>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div style={{background: '#F9FAFB', border: '1px solid #E8E9E9', borderRadius: '8px', padding: '16px'}}>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px'}}>
                                    <label className="label">Vista Previa:</label>
                                    {(() => {
                                        const quality = getPromptQuality();
                                        return (
                                            <span style={{fontSize: '14px', fontWeight: 600, color: quality.color}}>
                                                {quality.emoji} {quality.text}
                                            </span>
                                        );
                                    })()}
                                </div>
                                <div className="response-box" style={{maxHeight: '150px'}}>
                                    {buildPrompt() || 'Completa los campos...'}
                                </div>
                            </div>
                        </div>
                    )}

                    {step === 1 && (
                        <div className="space-y-6">
                            <div className="alert alert-blue">
                                <strong>üéØ Paso 2: Genera y Analiza</strong><br/><br/>
                                üëá Genera tu contenido y analiza qu√© funcion√≥ y qu√© mejorar.
                            </div>

                            <div style={{background: '#F9FAFB', padding: '16px', borderRadius: '8px'}}>
                                <label className="label">Tu Prompt:</label>
                                <div className="response-box" style={{maxHeight: '150px'}}>{buildPrompt()}</div>
                            </div>

                            <button onClick={() => generate(false)} disabled={!data.contentType || !data.topic || !data.purpose.length || !data.audience || !data.tone.length || loading} className="btn-primary">
                                {loading ? '‚ü≥ Generando...' : '‚ú® Generar Contenido'}
                            </button>

                            {resp1 && (
                                <>
                                    <div style={{background: '#EFF6FF', padding: '16px', borderRadius: '8px', border: '1px solid #BFDBFE'}}>
                                       <label className="label" style={{marginBottom: '12px'}}>Contenido Generado:</label>
    
                                        <div className="response-box">{resp1}</div>
                                        <div style={{marginTop: '8px'}}>
                                            <CopyButton text={resp1} id="resp1-step2-bottom" large />
                                        </div>
                                    </div>

                                    <div className="alert alert-orange">
                                        <strong>üîç Analiza los resultados:</strong>
                                    </div>

                                    <div className="space-y-4">
                                        <div>
                                            <label className="label">‚úÖ ¬øQu√© funcion√≥ bien?</label>
                                            <textarea value={ref.worked} onChange={(e) => setRef({...ref, worked: e.target.value})}
                                                placeholder="Ej: El tono fue perfecto..." maxLength={500} className="textarea-field"></textarea>
                                        </div>
                                        <div>
                                            <label className="label">‚ùå ¬øQu√© no funcion√≥?</label>
                                            <textarea value={ref.notWorked} onChange={(e) => setRef({...ref, notWorked: e.target.value})}
                                                placeholder="Ej: Muy formal..." maxLength={500} className="textarea-field"></textarea>
                                        </div>
                                        <div>
                                            <label className="label">üîß ¬øQu√© cambiar√°s?</label>
                                            <textarea value={ref.change} onChange={(e) => setRef({...ref, change: e.target.value})}
                                                placeholder="Ej: Agregar ejemplos..." maxLength={500} className="textarea-field"></textarea>
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>
                    )}
{step === 2 && (
    <div className="space-y-6">
        <div className="alert alert-blue">
            <strong>üéØ Paso 3: Mejora tu Prompt</strong><br/><br/>
            üëá Revisa tu plan y ajusta los campos necesarios para mejorar tu resultado.
        </div>

        <div style={{background: '#FFF7ED', padding: '16px', borderRadius: '8px', border: '1px solid #FED7AA'}}>
            <label className="label">üìã Tu Plan para Mejorar:</label>
            <p style={{fontSize: '14px', marginBottom: '12px', fontStyle: 'italic'}}>"{ref.change || 'No hay cambios a√∫n'}"</p>
        </div>

        <div style={{background: '#F0F9FF', padding: '20px', borderRadius: '8px', border: '2px solid #BFDBFE'}}>
            <h3 style={{fontSize: '16px', fontWeight: 700, marginBottom: '16px', color: '#1E40AF'}}>
                ‚úèÔ∏è Ajusta tu Prompt
            </h3>

            <div className="space-y-4">
                <div>
                    <label className="label">Prop√≥sito <span style={{fontSize: '12px', fontWeight: 400, color: '#8A8B8C'}}>(puedes elegir varios)</span></label>
                    <div style={{display: 'flex', flexWrap: 'wrap', gap: '6px'}}>
                        {purposes.map(p => (
                            <button key={p} onClick={() => toggleMulti('purpose', p)}
                                className={`content-btn ${data.purpose.includes(p) ? 'active' : ''}`}
                                style={{padding: '6px 12px', fontSize: '12px', flex: 'none'}}>
                                {p}
                            </button>
                        ))}
                    </div>
                    {data.purpose.includes('Otro') && (
                        <input type="text" value={data.customPurpose || ''} onChange={(e) => update('customPurpose', e.target.value)}
                            placeholder="Escribe tu prop√≥sito..." maxLength={100}
                            className="input-field" style={{marginTop: '8px'}} />
                    )}
                </div>
                <div>
                    <label className="label">Tono <span style={{fontSize: '12px', fontWeight: 400, color: '#8A8B8C'}}>(puedes elegir varios)</span></label>
                    <div style={{display: 'flex', flexWrap: 'wrap', gap: '6px'}}>
                        {tones.map(t => (
                            <button key={t} onClick={() => toggleMulti('tone', t)}
                                className={`content-btn ${data.tone.includes(t) ? 'active' : ''}`}
                                style={{padding: '6px 12px', fontSize: '12px', flex: 'none'}}>
                                {t}
                            </button>
                        ))}
                    </div>
                    {data.tone.includes('Otro') && (
                        <input type="text" value={data.customTone || ''} onChange={(e) => update('customTone', e.target.value)}
                            placeholder="Escribe tu tono..." maxLength={100}
                            className="input-field" style={{marginTop: '8px'}} />
                    )}
                </div>

                <div className="grid-2">
                    <div>
                        <label className="label">Audiencia</label>
                        <input type="text" value={data.audience} onChange={(e) => update('audience', e.target.value)}
                            className="input-field" />
                    </div>
                    <div>
                        <label className="label">Extensi√≥n</label>
                        <select value={data.length} onChange={(e) => update('length', e.target.value)} className="input-field">
                            <option value="">Seleccionar extensi√≥n...</option>
                            <option value="~100 palabras">Muy corto (~100 palabras)</option>
                            <option value="~250 palabras">Corto (~250 palabras)</option>
                            <option value="~500 palabras">Medio (~500 palabras)</option>
                            <option value="~1000 palabras">Largo (~1000 palabras)</option>
                            <option value="~2000 palabras">Muy largo (~2000 palabras)</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label className="label">Palabras clave</label>
                    <input 
                        type="text"
                        value={data.keywords || ''} 
                        onChange={(e) => update('keywords', e.target.value)} 
                        className="input-field"
                        placeholder="Ej: innovaci√≥n, sostenibilidad, ROI"
                    />
                </div>

                <div>
                    <label className="label">Instrucciones adicionales</label>
                    <textarea
                        value={data.additionalInstructions || ''}
                        onChange={(e) => update('additionalInstructions', e.target.value)}
                        className="textarea-field"
                        maxLength={1000}
                        placeholder="Ej: Formato con bullets, incluir 3 CTAs, evitar clich√©s..."
                        rows="3"
                    />
                </div>
            </div>
        </div>

        <div style={{background: '#F9FAFB', padding: '16px', borderRadius: '8px'}}>
            <label className="label">Vista Previa del Prompt Mejorado:</label>
            <div className="response-box" style={{maxHeight: '200px'}}>{buildPrompt()}</div>
        </div>

        <div style={{background: '#FFF3CD', padding: '16px', borderRadius: '8px', border: '1px solid #FFC107'}}>
            <label className="label" style={{color: '#856404', marginBottom: '8px'}}>üìù Recordatorio de tu plan:</label>
            <p style={{fontSize: '14px', color: '#856404', fontStyle: 'italic', marginBottom: '12px'}}>
                "{ref.change || 'Sin cambios espec√≠ficos registrados'}"
            </p>
            <div style={{borderTop: '1px solid #FFC107', paddingTop: '12px', marginTop: '8px'}}>
                <p style={{fontSize: '13px', color: '#856404', margin: 0}}>
                    üí° <strong>Importante:</strong> La IA generar√° contenido completamente nuevo basado en tu prompt mejorado. Incluso los campos que no modificaste pueden producir texto diferente, ya que la IA crea contenido √∫nico en cada generaci√≥n.
                </p>
            </div>
        </div>

        <button onClick={() => generate(true)} disabled={loading} className="btn-primary">
            {loading ? '‚ü≥ Generando...' : '‚ú® Generar Versi√≥n Mejorada'}
        </button>

        {resp2 && (
            <>
                <div>
                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '16px'}}>
                        <h3 style={{fontSize: '18px', fontWeight: 600}}>Compara tus resultados</h3>
                    </div>
                    <div className="grid-2">
                        <div style={{background: '#F3F4F6', padding: '16px', borderRadius: '8px', border: '2px solid #9CA3AF'}}>
                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'}}>
                                <label className="label">üìÑ Primera versi√≥n</label>
                                <CopyButton text={resp1} id="resp1-compare" />
                            </div>
                            <div className="response-box" style={{fontSize: '14px', maxHeight: '300px'}}>{resp1}</div>
                            <div style={{marginTop: '12px', padding: '8px', background: '#E5E7EB', borderRadius: '4px'}}>
                                <p style={{fontSize: '12px', color: '#374151', margin: 0}}>
                                    üìä {resp1.split(' ').length} palabras
                                </p>
                            </div>
                        </div>
                        <div style={{background: '#F3F4F6', padding: '16px', borderRadius: '8px', border: '2px solid #9CA3AF'}}>
                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'}}>
                                <label className="label">‚ú® Versi√≥n mejorada</label>
                                <CopyButton text={resp2} id="resp2-compare" />
                            </div>
                            <div className="response-box" style={{fontSize: '14px', maxHeight: '300px'}}>{resp2}</div>
                            <div style={{marginTop: '12px', padding: '8px', background: '#E5E7EB', borderRadius: '4px'}}>
                                <p style={{fontSize: '12px', color: '#374151', margin: 0}}>
                                    üìä {resp2.split(' ').length} palabras
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </>
        )}
    </div>
)}
                    {step === 3 && (
                        <div className="space-y-6">
                            <div className="alert alert-orange">
                                <strong>üéØ Paso 4: Compara Resultados</strong><br/><br/>
                                Genera la versi√≥n mejorada y comp√°rala con la primera.
                            </div>

                            <div style={{background: '#F9FAFB', padding: '16px', borderRadius: '8px'}}>
                                <div className="response-box" style={{maxHeight: '150px'}}>{buildPrompt()}</div>
                            </div>

                            <button onClick={() => generate(true)} disabled={loading} className="btn-primary">
                                {loading ? '‚ü≥ Generando...' : '‚ú® Generar Mejorado'}
                            </button>

                            {resp2 && (
                                <>
                                   <div className="grid-2">
    <div style={{background: '#EFF6FF', padding: '16px', borderRadius: '8px'}}>
        <label className="label" style={{marginBottom: '12px'}}>Primera:</label>
        <div className="response-box">{resp1}</div>
        <div style={{marginTop: '8px'}}>
            <CopyButton text={resp1} id="resp1-step4-bottom" large />
        </div>
    </div>
    
    <div style={{background: '#F0FDF4', padding: '16px', borderRadius: '8px'}}>
        <label className="label" style={{marginBottom: '12px'}}>Mejorada:</label>
        <div className="response-box">{resp2}</div>
        <div style={{marginTop: '8px'}}>
            <CopyButton text={resp2} id="resp2-step4-bottom" large />
        </div>
    </div>
</div>
                                   <div style={{background: '#F3F4F6', padding: '24px', borderRadius: '8px', border: '1px solid #9CA3AF'}}>
    <h3 style={{fontWeight: 700, color: '#374151', marginBottom: '16px'}}>üìù Reflexi√≥n Final</h3>
    
    <div className="space-y-4">
        {/* Pregunta 1: Radio buttons */}
        <div>
            <label className="label" style={{marginBottom: '12px', display: 'block'}}>
                ‚úì El prompt que mejor logr√≥ mi prop√≥sito fue:
            </label>
            <div style={{display: 'flex', gap: '20px', marginLeft: '8px'}}>
                <label style={{display: 'flex', alignItems: 'center', cursor: 'pointer'}}>
                    <input
                        type="radio"
                        name="betterPrompt"
                        value="inicial"
                        checked={finalRef.betterPrompt === 'inicial'}
                        onChange={(e) => setFinalRef({...finalRef, betterPrompt: e.target.value})}
                        style={{marginRight: '8px'}}
                    />
                    Prompt Inicial
                </label>
                <label style={{display: 'flex', alignItems: 'center', cursor: 'pointer'}}>
                    <input
                        type="radio"
                        name="betterPrompt"
                        value="mejorado"
                        checked={finalRef.betterPrompt === 'mejorado'}
                        onChange={(e) => setFinalRef({...finalRef, betterPrompt: e.target.value})}
                        style={{marginRight: '8px'}}
                    />
                    Prompt Mejorado
                </label>
            </div>
        </div>

        {/* Pregunta 2: Radio buttons con opciones */}
        <div>
            <label className="label" style={{marginBottom: '12px', display: 'block'}}>
                ‚úì El cambio que hizo la mayor diferencia fue:
            </label>
            <div style={{marginLeft: '8px'}}>
                {[
                    {value: 'contexto', label: 'Ser m√°s espec√≠fico con el contexto'},
                    {value: 'instrucciones', label: 'Mejorar las instrucciones'},
                    {value: 'tono', label: 'Ajustar el tono'},
                    {value: 'ejemplos', label: 'Dar ejemplos concretos'}
                ].map(option => (
                    <label key={option.value} style={{display: 'block', marginBottom: '8px', cursor: 'pointer'}}>
                        <input
                            type="radio"
                            name="biggestChange"
                            value={option.value}
                            checked={finalRef.biggestChange === option.value}
                            onChange={(e) => setFinalRef({...finalRef, biggestChange: e.target.value})}
                            style={{marginRight: '8px'}}
                        />
                        {option.label}
                    </label>
                ))}
                <label style={{display: 'flex', alignItems: 'center', cursor: 'pointer', marginTop: '8px'}}>
                    <input
                        type="radio"
                        name="biggestChange"
                        value="otro"
                        checked={finalRef.biggestChange === 'otro'}
                        onChange={(e) => setFinalRef({...finalRef, biggestChange: e.target.value})}
                        style={{marginRight: '8px'}}
                    />
                    Otro:
                    <input
                        type="text"
                        value={finalRef.otherChange || ''}
                        onChange={(e) => setFinalRef({...finalRef, otherChange: e.target.value})}
                        disabled={finalRef.biggestChange !== 'otro'}
                        placeholder="Especifica..."
                        style={{
                            marginLeft: '8px',
                            padding: '6px 12px',
                            border: '1px solid #D1D5DB',
                            borderRadius: '4px',
                            flex: 1,
                            backgroundColor: finalRef.biggestChange !== 'otro' ? '#F9FAFB' : 'white'
                        }}
                    />
                </label>
            </div>
        </div>

        {/* Pregunta 3: Textarea corto */}
        <div>
            <label className="label">üí° Un insight clave que me llevo:</label>
            <textarea 
                value={finalRef.keyInsight || ''} 
                onChange={(e) => setFinalRef({...finalRef, keyInsight: e.target.value})}
                className="textarea-field"
                rows="3"
                placeholder="Escribe 1-2 l√≠neas sobre lo que aprendiste..."
            ></textarea>
        </div>
    </div>
</div>
                                    <div style={{background: '#F3F4F6', padding: '24px', borderRadius: '8px'}}>
    <h3 style={{fontWeight: 700, color: '#000000', marginBottom: '12px'}}>üéâ Puntos Clave</h3>
    <p style={{fontSize: '14px', color: '#000000', marginBottom: '4px'}}>‚úì Peque√±os cambios = grandes mejoras</p>
    <p style={{fontSize: '14px', color: '#000000', marginBottom: '4px'}}>‚úì La especificidad es clave</p>
    <p style={{fontSize: '14px', color: '#000000', marginBottom: '16px'}}>‚úì Los ejemplos son poderosos</p>
    
   <div style={{display: 'flex', gap: '8px', marginBottom: '12px'}}>
    <button onClick={exportData} className="btn-primary" style={{flex: 1}}>
        üìÑ Exportar TXT
    </button>
    <button onClick={exportToWord} className="btn-primary" style={{flex: 1}}>
        üìò Exportar Word
    </button>
    <button onClick={copyAllToClipboard} className="btn-primary" style={{flex: 1, background: '#10B981'}}>
        üìã Copiar Todo
    </button>
</div>
<div style={{background: '#FFF9F0', padding: '12px', borderRadius: '8px', border: '1px solid #FFE4B5', marginBottom: '12px'}}>
    <p style={{fontSize: '12px', color: '#8A8B8C', margin: 0, textAlign: 'center'}}>
        üì± <strong>En m√≥vil:</strong> Usa "Exportar TXT" o "Copiar Todo" - el contenido se copiar√° autom√°ticamente. Luego p√©galo en Notes, Gmail, o Google Drive.
        <br/>
        üíª <strong>En computadora:</strong> Todos los formatos funcionan. "Copiar Todo" copia al portapapeles para pegar donde quieras.
    </p>
</div>
    <button 
        onClick={() => {
            if (window.confirm('¬øEst√°s seguro? Esto borrar√° todo tu progreso actual y volver√°s al inicio.')) {
                setStep(0);
                setData({
                    contentType: '',
                    docSubtype: [],
                    presentationSubtype: [],
                    proposalSubtype: [],
                    socialSubtype: '',
                    topic: '',
                    purpose: [],
                    customPurpose: '',
                    audience: '',
                    tone: [],
                    customTone: '',
                    length: '',
                    format: '',
                    examples: '',
                    constraints: '',
                    keywords: '',
                    additionalInstructions: ''
                });
                setResp1('');
                setResp2('');
                setRef({ worked: '', notWorked: '', change: '' });
                setFinalRef({ better: '', tone: '', bigChange: '', learning: '' });
            }
        }}
        className="btn-secondary"
        style={{width: '100%'}}
    >
        üîÑ Empezar Nuevo Proyecto
    </button>
</div>
                                    </>
                            )}
                        </div>
                    )}
                </div>

                <div className="card">
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                        <button onClick={() => { setStep(Math.max(0, step - 1)); window.scrollTo({ top: 0, behavior: 'smooth' }); }} disabled={step === 0} className="btn-secondary">
                            ‚Üê Atr√°s
                        </button>
                        <p style={{fontSize: '14px', color: '#8A8B8C'}}>Paso {step + 1} de 4</p>
                    <button
    onClick={() => {
        const nextStep = Math.min(3, step + 1);

        // Si va del Paso 2 al Paso 3 y tiene plan de mejora, auto-llenarlo
        if (step === 1 && nextStep === 2 && ref.change) {
            const newInstructions = data.additionalInstructions
                ? data.additionalInstructions + '\n\n' + ref.change
                : ref.change;

            setData(prev => ({
                ...prev,
                additionalInstructions: newInstructions
            }));
        }

        setStep(nextStep);
        // Scroll to top for smooth transition
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }}
    disabled={step === 3}
    className="btn-primary"
    style={{width: 'auto', display: step === 3 ? 'none' : 'block'}}
>
    Siguiente ‚Üí
</button>
                    </div>
                </div>

                <div style={{textAlign: 'center', padding: '20px', color: '#8A8B8C', fontSize: '14px'}}>
                    <a href="https://www.celestemartinez.net" target="_blank" rel="noopener noreferrer" style={{color: '#FF7A00', textDecoration: 'none', fontWeight: 600}}>
                        www.celestemartinez.net
                    </a>
                </div>
            </div>
        );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    <!-- Limits and Modals System -->
<script src="js/limits.js"></script>
<script src="js/modals.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptLab - Escritura con IA</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: linear-gradient(to bottom right, #FFF5EE, #F5F5F5); min-height: 100vh; }
        .container { max-width: 1024px; margin: 0 auto; padding: 24px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); padding: 32px; margin-bottom: 24px; }
        .logo-container { display: flex; align-items: center; gap: 16px; margin-bottom: 8px; }
        .logo { height: 120px; width: auto; }
        .btn-primary { background: #FF7A00; color: white; padding: 16px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; width: 100%; font-size: 16px; }
        .btn-primary:hover:not(:disabled) { opacity: 0.9; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary { background: #E8E9E9; color: #4A4A4A; padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; }
        .input-field, .textarea-field, select { width: 100%; padding: 12px; border: 2px solid #E8E9E9; border-radius: 8px; font-size: 16px; font-family: 'Montserrat', sans-serif; }
        .input-field:focus, .textarea-field:focus, select:focus { outline: none; border-color: #FF7A00; }
        .textarea-field { min-height: 96px; resize: vertical; }
        .label { display: block; font-weight: 600; font-size: 16px; color: #374151; margin-bottom: 8px; }
        .helper-text { font-size: 14px; color: #8A8B8C; margin-top: 4px; }
        .content-btn { padding: 12px; border: 2px solid #E8E9E9; border-radius: 8px; background: white; cursor: pointer; text-align: center; }
        .content-btn.active { border-color: #FF7A00; background: #FFF5EE; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .space-y-4 > * + * { margin-top: 16px; }
        .space-y-6 > * + * { margin-top: 24px; }
        .alert { padding: 16px; border-left: 4px solid; border-radius: 8px; font-size: 16px; margin-bottom: 16px; }
        .alert-blue { background: #F3F4F6; border-color: #6B7280; color: #000000; }
        .alert-green { background: #F0FDF4; border-color: #22C55E; color: #166534; }
        .alert-orange { background: #FED7AA; border-color: #F59E0B; color: #000000; }
        .alert-purple { background: #FAF5FF; border-color: #A855F7; color: #6B21A8; }
        .alert-pink { background: #FCE7F3; border-color: #EC4899; color: #831843; }
        .response-box { background: white; border: 1px solid #E8E9E9; border-radius: 8px; padding: 16px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; font-size: 16px; }
        .step-indicator { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
        .progress-line { flex: 1; height: 4px; margin: 0 8px; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @media (max-width: 768px) { .grid-2, .grid-4 { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
    const { useState } = React;

    const App = () => {
        const [step, setStep] = useState(0);
        const [data, setData] = useState({
            contentType: '', 
            docSubtype: '',
            presentationSubtype: '',
            proposalSubtype: '',
            socialSubtype: '',
            topic: '', 
            purpose: '', 
            audience: '', 
            tone: '', 
            length: '',
            format: '', 
            examples: '', 
            constraints: '',
            keywords: '',
            additionalInstructions: ''
        });
        const [resp1, setResp1] = useState('');
        const [resp2, setResp2] = useState('');
        const [ref, setRef] = useState({ worked: '', notWorked: '', change: '' });
        const [finalRef, setFinalRef] = useState({ better: '', tone: '', bigChange: '', learning: '' });
        const [loading, setLoading] = useState(false);

        const types = [
            { id: 'email', label: 'Correo electr√≥nico/Mensaje', emoji: 'üìß' },
            { id: 'report', label: 'Informe', emoji: 'üìä' },
            { id: 'presentation', label: 'Presentaci√≥n', emoji: 'üìΩÔ∏è', hasSubtypes: true },
            { id: 'proposal', label: 'Propuesta', emoji: 'üíº', hasSubtypes: true },
            { id: 'documentation', label: 'Documentaci√≥n', emoji: 'üìù', hasSubtypes: true },
            { id: 'article', label: 'Art√≠culo/Blog', emoji: '‚úçÔ∏è' },
            { id: 'social', label: 'Redes Sociales', emoji: 'üì±', hasSubtypes: true }
        ];

        const docSubtypes = [
            'Manual de Usuario',
            'Gu√≠a T√©cnica',
            'Procedimiento (SOP)',
            'Pol√≠tica Interna',
            'Resumen Ejecutivo'
        ];

        const presentationSubtypes = [
            'Pitch Deck',
            'Training',
            'Informe Ejecutivo',
            'Reuni√≥n de Equipo',
            'Webinar'
        ];

        const proposalSubtypes = [
            'Comercial',
            'Proyecto',
            'Presupuesto',
            'Colaboraci√≥n',
            'Auspicio'
        ];

        const socialSubtypes = {
            'Facebook': 'En Facebook, prioriza un tono conversacional que fomente la conexi√≥n personal y el sentido de comunidad. Evita estructuras que parezcan anuncios publicitarios directos; en su lugar, enf√≥cate en contar una historia o compartir valor de forma genuina.',
            'Instagram': 'En Instagram, el contenido debe ser visualmente descriptivo y directo. Prioriza un inicio impactante (gancho) y utiliza p√°rrafos muy cortos o listas. La IA debe entender que el texto acompa√±a a una imagen o video, por lo que debe ser est√©tico y f√°cil de leer de un vistazo.',
            'LinkedIn': 'En LinkedIn, el tono debe ser profesional pero humano (aut√©ntico). El enfoque debe estar en compartir una lecci√≥n aprendida, un dato relevante o una reflexi√≥n de valor para la industria. Evita el lenguaje demasiado informal o "clich√©"; busca que el autor suene como un experto confiable.',
            'TikTok': 'Para TikTok, el texto debe funcionar como un guion de ritmo r√°pido. La instrucci√≥n es ser extremadamente conciso, usar un lenguaje coloquial y din√°mico. La IA debe enfocarse en entregar la informaci√≥n m√°s importante de inmediato para evitar que el usuario deslice hacia abajo.'
        };

        const purposes = [
            'Informar/Educar', 'Persuadir/Convencer', 'Inspirar/Motivar',
            'Anunciar/Actualizar', 'Solicitar/Proponer', 'Documentar/Registrar'
        ];

        const tones = [
            'Profesional', 'Casual/Conversacional', 'Formal',
            'Amigable', 'Autoritario', 'Emp√°tico'
        ];

        const steps = ['Crear', 'Probar & Analizar', 'Mejorar', 'Comparar & Aprender'];

        const update = (k, v) => {
            setData(prev => {
                const newData = { ...prev, [k]: v };
                if (k === 'contentType') {
                    newData.docSubtype = '';
                    newData.presentationSubtype = '';
                    newData.proposalSubtype = '';
                    newData.socialSubtype = '';
                }
                return newData;
            });
        };

        const getPromptQuality = () => {
            const requiredFields = ['contentType', 'topic', 'purpose', 'audience', 'tone'];
            const filledRequired = requiredFields.filter(f => data[f]).length;
            const optionalFields = ['length', 'keywords', 'additionalInstructions'];
            const filledOptional = optionalFields.filter(f => data[f]).length;
            
            const needsSubtype = data.contentType === 'documentation' || 
                                 data.contentType === 'presentation' || 
                                 data.contentType === 'proposal' || 
                                 data.contentType === 'social';
            
            const hasSubtype = data.docSubtype || data.presentationSubtype || data.proposalSubtype || data.socialSubtype;
            
            if (filledRequired === 5 && (!needsSubtype || hasSubtype) && filledOptional >= 2) {
                return { emoji: 'üü¢', text: 'Excelente', color: '#22C55E' };
            } else if (filledRequired === 5 && (!needsSubtype || hasSubtype)) {
                return { emoji: 'üü°', text: 'Bueno', color: '#F59E0B' };
            } else {
                return { emoji: 'üî¥', text: 'Necesita m√°s detalles', color: '#EF4444' };
            }
        };

        const buildPrompt = () => {
            let p = '';
            let typeLabel = '';
            
            if (data.contentType) {
                const t = types.find(x => x.id === data.contentType);
                
                if (data.contentType === 'documentation' && data.docSubtype) {
                    typeLabel = data.docSubtype;
                } else if (data.contentType === 'presentation' && data.presentationSubtype) {
                    typeLabel = data.presentationSubtype;
                } else if (data.contentType === 'proposal' && data.proposalSubtype) {
                    typeLabel = data.proposalSubtype;
                } else if (data.contentType === 'social' && data.socialSubtype) {
                    typeLabel = `publicaci√≥n para ${data.socialSubtype}`;
                } else {
                    typeLabel = t.label.toLowerCase();
                }
                
                p = `Escribe ${typeLabel}`;
            }
            
            if (data.topic) p += ` sobre ${data.topic}`;
            p += '.';
            
            if (data.contentType === 'social' && data.socialSubtype) {
                p += `\n\nIMPORTANTE - Best Practice de ${data.socialSubtype}:\n${socialSubtypes[data.socialSubtype]}`;
            }
            
            const d = [];
            if (data.purpose) d.push(`Prop√≥sito: ${data.purpose}`);
            if (data.audience) d.push(`Audiencia: ${data.audience}`);
            if (data.tone) d.push(`Tono: ${data.tone}`);
            if (data.length) d.push(`Extensi√≥n: ${data.length}`);
            if (d.length > 0) p += '\n\n' + d.join('\n');
            
            if (data.format) p += `\n\nFormato: ${data.format}`;
            if (data.examples) p += `\n\nEstilo: ${data.examples}`;
            if (data.constraints) p += `\n\nRequisitos: ${data.constraints}`;
            if (data.keywords) p += `\n\nPalabras clave a incluir obligatoriamente: ${data.keywords}`;
            if (data.additionalInstructions) p += `\n\nInstrucciones adicionales: ${data.additionalInstructions}`;
            p += `\n\n[ESTILO CR√çTICO]: S√© directo y aut√©ntico. NO uses frases clich√© como "en el mundo de hoy", "es fundamental", "cabe destacar". NO uses lenguaje corporativo vac√≠o. Escribe como un humano real, no como un robot. Prioriza claridad sobre elegancia.`;
            
            return p.trim();
        };

        const generate = async (isRevised) => {
    setLoading(true);
    
    try {
        let requestBody;
        
        if (isRevised && resp1) {
            // Enviar conversaci√≥n con memoria real
            const currentPrompt = buildPrompt();
            const improvementPlan = ref.change || 'Mejorar el contenido seg√∫n los ajustes en el prompt';
            
            requestBody = {
                messages: [
                    { 
                        role: "user", 
                        content: buildPrompt() // El prompt original que gener√≥ resp1
                    },
                    { 
                        role: "assistant", 
                        content: resp1 
                    },
                    { 
                        role: "user", 
                        content: `Ahora necesito que mejores el contenido anterior aplicando estos cambios espec√≠ficos:

üìù Plan de mejora: ${improvementPlan}

üéØ Nuevo prompt con ajustes:
${currentPrompt}

INSTRUCCIONES CR√çTICAS:
1. MANT√âN las ideas principales y estructura que funcionaron bien del contenido anterior
2. APLICA espec√≠ficamente los cambios solicitados (tono, extensi√≥n, palabras clave, formato, etc.)
3. Si cambi√≥ el tono, ajusta SOLO el tono manteniendo el contenido
4. Si cambi√≥ la extensi√≥n, ajusta la longitud sin perder informaci√≥n clave
5. Si hay nuevas instrucciones adicionales, apl√≠calas sobre el contenido existente
6. Haz mejoras incrementales y precisas sobre el texto anterior, NO generes contenido completamente nuevo desde cero`
                    }
                ]
            };
        } else {
            // Primera generaci√≥n sin memoria
            requestBody = {
                prompt: buildPrompt()
            };
        }
        
        const res = await fetch("/api/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestBody)
        });
        
        if (!res.ok) {
            const errorData = await res.json();
            throw new Error(errorData.error || `Error ${res.status}`);
        }
        
        const json = await res.json();
        const text = json.text || "";
        
        if (!text) {
            throw new Error("No se recibi√≥ contenido");
        }
        
        isRevised ? setResp2(text) : setResp1(text);
        
    } catch (e) {
        console.error('Error:', e);
        const errorMsg = `‚ùå Error: ${e.message}`;
        isRevised ? setResp2(errorMsg) : setResp1(errorMsg);
    } finally {
        setLoading(false);
    }
};
        const copy = (text) => {
            navigator.clipboard.writeText(text);
            alert('Copiado');
        };

        const exportData = () => {
            const content = `PROYECTO PROMPTLAB\n\nPROMPT INICIAL:\n${buildPrompt()}\n\nRESPUESTA 1:\n${resp1}\n\nREFLEXI√ìN:\n${ref.worked}\n${ref.notWorked}\n${ref.change}\n\nPROMPT MEJORADO:\n${buildPrompt()}\n\nRESPUESTA 2:\n${resp2}\n\nAPRENDIZAJES:\n${finalRef.learning}`;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'promptlab-proyecto.txt';
            a.click();
        };

        const exportToWord = () => {
            const content = `
        <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'>
        <head><meta charset='utf-8'><title>PromptLab Export</title></head>
        <body>
            <h1>PromptLab - Proyecto</h1>
            <!-- Indicador de uso -->
<div id="usage-indicator" class="alert alert-info" style="display: none; margin: 20px 0;">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
            <span id="usage-icon" style="font-size: 24px;">‚ú®</span>
            <strong id="usage-text" class="ms-2">0 de 10 prompts usados esta semana</strong>
            <br>
            <small id="remaining-text" class="text-muted ms-5"></small>
        </div>
    </div>
    <div class="progress" style="height: 6px;">
        <div id="progress-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
    </div>
</div>
            <h2>Prompt Inicial</h2>
            <p>${buildPrompt().replace(/\n/g, '<br>')}</p>
            <h2>Primera Versi√≥n</h2>
            <p>${resp1.replace(/\n/g, '<br>')}</p>
            ${resp2 ? `<h2>Versi√≥n Mejorada</h2><p>${resp2.replace(/\n/g, '<br>')}</p>` : ''}
            <h2>Aprendizajes</h2>
            <p>${finalRef.learning || 'Sin aprendizajes registrados'}</p>
        </body>
        </html>
    `;
            const blob = new Blob(['\ufeff', content], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'promptlab-proyecto.doc';
            a.click();
            URL.revokeObjectURL(url);
        };

        return (
            <div className="container">
                <div className="card">
                    <div className="logo-container">
                        <img 
                            src="https://i.imgur.com/KOEutOB.jpeg" 
                            alt="Logo" 
                            className="logo"
                        />
                        <div>
                            <h1 style={{fontSize: '30px', fontWeight: 700, color: '#000000', marginBottom: '4px'}}>
                                PromptLab - Escritura con IA
                            </h1>
                            <p style={{color: '#8A8B8C'}}>Obt√©n mejores resultados de IA con prompts bien dise√±ados</p>
                        </div>
                    </div>
                </div>

                <div className="card">
                    <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>
                        {steps.map((label, i) => (
                            <React.Fragment key={i}>
                                <div style={{display: 'flex', flexDirection: 'column', alignItems: 'center', flex: 1}}>
                                    <div className="step-indicator" style={{
                                        backgroundColor: i === step ? '#FF7A00' : i < step ? '#FFA347' : '#E8E9E9',
                                        color: i <= step ? 'white' : '#9CA3AF'
                                    }}>
                                        {i + 1}
                                    </div>
                                    <div style={{
                                        fontSize: '12px', marginTop: '4px', textAlign: 'center',
                                        fontWeight: i === step ? 600 : 400,
                                        color: i === step ? '#FF7A00' : '#8A8B8C'
                                    }}>
                                        {label}
                                    </div>
                                </div>
                                {i < 3 && <div className="progress-line" style={{
                                    backgroundColor: i < step ? '#FFA347' : '#E8E9E9'
                                }} />}
                            </React.Fragment>
                        ))}
                    </div>
                </div>

                <div className="card">
                    {step === 0 && (
                        <div className="space-y-6">
                            <div className="alert alert-blue">
                                <strong>üéØ Paso 1: Crea tu Prompt</strong><br/><br/>
                                Un buen prompt es espec√≠fico y claro. Completa estos campos para que la IA entienda exactamente qu√© necesitas. Mientras m√°s detalles des, mejores ser√°n los resultados.
                            </div>

                            <div>
                                <label className="label">1. Tipo de Contenido *</label>
                                <div className="grid-4">
                                    {types.map(t => (
                                        <button key={t.id} onClick={() => update('contentType', t.id)}
                                            className={`content-btn ${data.contentType === t.id ? 'active' : ''}`}>
                                            <div style={{fontSize: '24px', marginBottom: '4px'}}>{t.emoji}</div>
                                            <div style={{fontSize: '12px', fontWeight: 500}}>{t.label}</div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {data.contentType === 'documentation' && (
                                <div>
                                    <label className="label">Tipo de Documento *</label>
                                    <select value={data.docSubtype} onChange={(e) => update('docSubtype', e.target.value)} className="input-field">
                                        <option value="">Seleccionar tipo de documento...</option>
                                        {docSubtypes.map(st => <option key={st} value={st}>{st}</option>)}
                                    </select>
                                </div>
                            )}

                            {data.contentType === 'presentation' && (
                                <div>
                                    <label className="label">Tipo de Presentaci√≥n *</label>
                                    <select value={data.presentationSubtype} onChange={(e) => update('presentationSubtype', e.target.value)} className="input-field">
                                        <option value="">Seleccionar tipo de presentaci√≥n...</option>
                                        {presentationSubtypes.map(st => <option key={st} value={st}>{st}</option>)}
                                    </select>
                                </div>
                            )}

                            {data.contentType === 'proposal' && (
                                <div>
                                    <label className="label">Tipo de Propuesta *</label>
                                    <select value={data.proposalSubtype} onChange={(e) => update('proposalSubtype', e.target.value)} className="input-field">
                                        <option value="">Seleccionar tipo de propuesta...</option>
                                        {proposalSubtypes.map(st => <option key={st} value={st}>{st}</option>)}
                                    </select>
                                </div>
                            )}

                            {data.contentType === 'social' && (
                                <div>
                                    <label className="label">Red Social *</label>
                                    <select value={data.socialSubtype} onChange={(e) => update('socialSubtype', e.target.value)} className="input-field">
                                        <option value="">Seleccionar red social...</option>
                                        {Object.keys(socialSubtypes).map(sn => <option key={sn} value={sn}>{sn}</option>)}
                                    </select>
                                    {data.socialSubtype && (
                                        <div style={{background: '#FFF7ED', border: '1px solid #FED7AA', borderRadius: '8px', padding: '12px', marginTop: '8px'}}>
                                            <p style={{fontSize: '12px', color: '#92400E'}}>
                                                <strong>üìå Best Practice:</strong> {socialSubtypes[data.socialSubtype]}
                                            </p>
                                        </div>
                                    )}
                                </div>
                            )}

                            <div>
                                <label className="label">2. ¬øSobre qu√© est√°s escribiendo? *</label>
                                <input type="text" value={data.topic} onChange={(e) => update('topic', e.target.value)}
                                    placeholder="Ej: El impacto del trabajo remoto en equipos de desarrollo"
                                    className="input-field" />
                                <p className="helper-text">Mientras m√°s espec√≠fico, mejores resultados</p>
                            </div>

                            <div className="grid-2">
                                <div>
                                    <label className="label">3. Prop√≥sito *</label>
                                    <select value={data.purpose} onChange={(e) => update('purpose', e.target.value)} className="input-field">
                                        <option value="">Seleccionar...</option>
                                        {purposes.map(p => <option key={p} value={p}>{p}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="label">4. Tono *</label>
                                    <select value={data.tone} onChange={(e) => update('tone', e.target.value)} className="input-field">
                                        <option value="">Seleccionar...</option>
                                        {tones.map(t => <option key={t} value={t}>{t}</option>)}
                                    </select>
                                </div>
                            </div>

                            <div className="grid-2">
                                <div>
                                    <label className="label">5. Audiencia *</label>
                                    <input type="text" value={data.audience} onChange={(e) => update('audience', e.target.value)}
                                        placeholder="Ej: Profesionales de 30+ a√±os" className="input-field" />
                                </div>
                                <div>
                                    <label className="label">6. Extensi√≥n</label>
                                    <select value={data.length} onChange={(e) => update('length', e.target.value)} className="input-field">
                                        <option value="">Seleccionar extensi√≥n...</option>
                                        <option value="~100 palabras">Muy corto (~100 palabras)</option>
                                        <option value="~250 palabras">Corto (~250 palabras)</option>
                                        <option value="~500 palabras">Medio (~500 palabras)</option>
                                        <option value="~1000 palabras">Largo (~1000 palabras)</option>
                                        <option value="~2000 palabras">Muy largo (~2000 palabras)</option>
                                    </select>
                                </div>
                            </div>

                            <div style={{borderTop: '2px solid #FF7A00', paddingTop: '24px'}}>
                                <h3 style={{fontSize: '18px', fontWeight: 700, marginBottom: '16px'}}>
                                    üìã Detalles Cr√≠ticos
                                </h3>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="label">7. Palabras clave (opcional)</label>
                                        <input 
                                            type="text"
                                            value={data.keywords || ''} 
                                            onChange={(e) => update('keywords', e.target.value)} 
                                            className="input-field"
                                            placeholder="Ej: innovaci√≥n, sostenibilidad, ROI, transformaci√≥n digital"
                                        />
                                        <p className="helper-text">Palabras que DEBEN aparecer en el contenido</p>
                                    </div>

                                    <div>
                                        <label className="label">8. Instrucciones adicionales (opcional)</label>
                                        <textarea 
                                            value={data.additionalInstructions || ''} 
                                            onChange={(e) => update('additionalInstructions', e.target.value)} 
                                            className="textarea-field" 
                                            placeholder="Ej: Formato con bullets, estilo como NYTimes, incluir 3 CTAs, usar datos del Q4, evitar jerga t√©cnica..."
                                            rows="2"
                                        />
                                        <p className="helper-text">Detalles espec√≠ficos √∫nicos de esta tarea</p>
                                    </div>
                                </div>
                            </div>

                            <div style={{background: '#F9FAFB', border: '1px solid #E8E9E9', borderRadius: '8px', padding: '16px'}}>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px'}}>
                                    <label className="label">Vista Previa:</label>
                                    {(() => {
                                        const quality = getPromptQuality();
                                        return (
                                            <span style={{fontSize: '14px', fontWeight: 600, color: quality.color}}>
                                                {quality.emoji} {quality.text}
                                            </span>
                                        );
                                    })()}
                                </div>
                                <div className="response-box" style={{maxHeight: '150px'}}>
                                    {buildPrompt() || 'Completa los campos...'}
                                </div>
                            </div>
                        </div>
                    )}

                    {step === 1 && (
                        <div className="space-y-6">
                            <div className="alert alert-blue">
                                <strong>üéØ Paso 2: Genera y Analiza</strong><br/><br/>
                                üëá Genera tu contenido y analiza qu√© funcion√≥ y qu√© mejorar.
                            </div>

                            <div style={{background: '#F9FAFB', padding: '16px', borderRadius: '8px'}}>
                                <label className="label">Tu Prompt:</label>
                                <div className="response-box" style={{maxHeight: '150px'}}>{buildPrompt()}</div>
                            </div>

                            <button onClick={() => generate(false)} disabled={!data.contentType || !data.topic || !data.purpose || !data.audience || !data.tone || loading} className="btn-primary">
                                {loading ? '‚ü≥ Generando...' : '‚ú® Generar Contenido'}
                            </button>

                            {resp1 && (
                                <>
                                    <div style={{background: '#EFF6FF', padding: '16px', borderRadius: '8px', border: '1px solid #BFDBFE'}}>
                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '12px'}}>
                                            <label className="label">Contenido Generado:</label>
                                            <button onClick={() => copy(resp1)} className="btn-secondary" style={{padding: '8px 16px', fontSize: '14px'}}>
                                                üìã Copiar
                                            </button>
                                        </div>
                                        <div className="response-box">{resp1}</div>
                                    </div>

                                    <div className="alert alert-orange">
                                        <strong>üîç Analiza los resultados:</strong>
                                    </div>

                                    <div className="space-y-4">
                                        <div>
                                            <label className="label">‚úÖ ¬øQu√© funcion√≥ bien?</label>
                                            <textarea value={ref.worked} onChange={(e) => setRef({...ref, worked: e.target.value})}
                                                placeholder="Ej: El tono fue perfecto..." className="textarea-field"></textarea>
                                        </div>
                                        <div>
                                            <label className="label">‚ùå ¬øQu√© no funcion√≥?</label>
                                            <textarea value={ref.notWorked} onChange={(e) => setRef({...ref, notWorked: e.target.value})}
                                                placeholder="Ej: Muy formal..." className="textarea-field"></textarea>
                                        </div>
                                        <div>
                                            <label className="label">üîß ¬øQu√© cambiar√°s?</label>
                                            <textarea value={ref.change} onChange={(e) => setRef({...ref, change: e.target.value})}
                                                placeholder="Ej: Agregar ejemplos..." className="textarea-field"></textarea>
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>
                    )}
{step === 2 && (
    <div className="space-y-6">
        <div className="alert alert-blue">
            <strong>üéØ Paso 3: Mejora tu Prompt</strong><br/><br/>
            üëá Revisa tu plan y ajusta los campos necesarios para mejorar tu resultado.
        </div>

        <div style={{background: '#FFF7ED', padding: '16px', borderRadius: '8px', border: '1px solid #FED7AA'}}>
            <label className="label">üìã Tu Plan de Mejora:</label>
            <p style={{fontSize: '14px', marginBottom: '12px', fontStyle: 'italic'}}>"{ref.change || 'No hay cambios a√∫n'}"</p>
        </div>

        <div style={{background: '#F0F9FF', padding: '20px', borderRadius: '8px', border: '2px solid #BFDBFE'}}>
            <h3 style={{fontSize: '16px', fontWeight: 700, marginBottom: '16px', color: '#1E40AF'}}>
                ‚úèÔ∏è Ajusta tu Prompt
            </h3>

            <div className="space-y-4">
                <div className="grid-2">
                    <div>
                        <label className="label">Prop√≥sito</label>
                        <select value={data.purpose} onChange={(e) => update('purpose', e.target.value)} className="input-field">
                            <option value="">Seleccionar...</option>
                            {purposes.map(p => <option key={p} value={p}>{p}</option>)}
                        </select>
                    </div>
                    <div>
                        <label className="label">Tono</label>
                        <select value={data.tone} onChange={(e) => update('tone', e.target.value)} className="input-field">
                            <option value="">Seleccionar...</option>
                            {tones.map(t => <option key={t} value={t}>{t}</option>)}
                        </select>
                    </div>
                </div>

                <div className="grid-2">
                    <div>
                        <label className="label">Audiencia</label>
                        <input type="text" value={data.audience} onChange={(e) => update('audience', e.target.value)}
                            className="input-field" />
                    </div>
                    <div>
                        <label className="label">Extensi√≥n</label>
                        <select value={data.length} onChange={(e) => update('length', e.target.value)} className="input-field">
                            <option value="">Seleccionar extensi√≥n...</option>
                            <option value="~100 palabras">Muy corto (~100 palabras)</option>
                            <option value="~250 palabras">Corto (~250 palabras)</option>
                            <option value="~500 palabras">Medio (~500 palabras)</option>
                            <option value="~1000 palabras">Largo (~1000 palabras)</option>
                            <option value="~2000 palabras">Muy largo (~2000 palabras)</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label className="label">Palabras clave</label>
                    <input 
                        type="text"
                        value={data.keywords || ''} 
                        onChange={(e) => update('keywords', e.target.value)} 
                        className="input-field"
                        placeholder="Ej: innovaci√≥n, sostenibilidad, ROI"
                    />
                </div>

                <div>
                    <label className="label">Instrucciones adicionales</label>
                    <textarea 
                        value={data.additionalInstructions || ''} 
                        onChange={(e) => update('additionalInstructions', e.target.value)} 
                        className="textarea-field" 
                        placeholder="Ej: Formato con bullets, incluir 3 CTAs, evitar clich√©s..."
                        rows="3"
                    />
                </div>
            </div>
        </div>

        <div style={{background: '#F9FAFB', padding: '16px', borderRadius: '8px'}}>
            <label className="label">Vista Previa del Prompt Mejorado:</label>
            <div className="response-box" style={{maxHeight: '200px'}}>{buildPrompt()}</div>
        </div>

        <div style={{background: '#FFF3CD', padding: '16px', borderRadius: '8px', border: '1px solid #FFC107'}}>
            <label className="label" style={{color: '#856404', marginBottom: '8px'}}>üìù Recordatorio de tu plan:</label>
            <p style={{fontSize: '14px', color: '#856404', fontStyle: 'italic', marginBottom: '12px'}}>
                "{ref.change || 'Sin cambios espec√≠ficos registrados'}"
            </p>
            <div style={{borderTop: '1px solid #FFC107', paddingTop: '12px', marginTop: '8px'}}>
                <p style={{fontSize: '13px', color: '#856404', margin: 0}}>
                    üí° <strong>Importante:</strong> La IA generar√° contenido completamente nuevo basado en tu prompt mejorado. Incluso los campos que no modificaste pueden producir texto diferente, ya que la IA crea contenido √∫nico en cada generaci√≥n.
                </p>
            </div>
        </div>

        <button onClick={() => generate(true)} disabled={loading} className="btn-primary">
            {loading ? '‚ü≥ Generando...' : '‚ú® Generar Versi√≥n Mejorada'}
        </button>

        {resp2 && (
            <>
                <div>
                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '16px'}}>
                        <h3 style={{fontSize: '18px', fontWeight: 600}}>Compara tus resultados</h3>
                    </div>
                    <div className="grid-2">
                        <div style={{background: '#F3F4F6', padding: '16px', borderRadius: '8px', border: '2px solid #9CA3AF'}}>
                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'}}>
                                <label className="label">üìÑ Primera versi√≥n</label>
                                <button onClick={() => copy(resp1)} className="btn-secondary" style={{padding: '6px 12px', fontSize: '12px'}}>
                                    üìã Copiar
                                </button>
                            </div>
                            <div className="response-box" style={{fontSize: '14px', maxHeight: '300px'}}>{resp1}</div>
                            <div style={{marginTop: '12px', padding: '8px', background: '#E5E7EB', borderRadius: '4px'}}>
                                <p style={{fontSize: '12px', color: '#374151', margin: 0}}>
                                    üìä {resp1.split(' ').length} palabras
                                </p>
                            </div>
                        </div>
                        <div style={{background: '#F3F4F6', padding: '16px', borderRadius: '8px', border: '2px solid #9CA3AF'}}>
                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'}}>
                                <label className="label">‚ú® Versi√≥n mejorada</label>
                                <button onClick={() => copy(resp2)} className="btn-secondary" style={{padding: '6px 12px', fontSize: '12px'}}>
                                    üìã Copiar
                                </button>
                            </div>
                            <div className="response-box" style={{fontSize: '14px', maxHeight: '300px'}}>{resp2}</div>
                            <div style={{marginTop: '12px', padding: '8px', background: '#E5E7EB', borderRadius: '4px'}}>
                                <p style={{fontSize: '12px', color: '#374151', margin: 0}}>
                                    üìä {resp2.split(' ').length} palabras
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </>
        )}
    </div>
)}
                    {step === 3 && (
                        <div className="space-y-6">
                            <div className="alert alert-orange">
                                <strong>üéØ Paso 4: Compara Resultados</strong><br/><br/>
                                Genera la versi√≥n mejorada y comp√°rala con la primera.
                            </div>

                            <div style={{background: '#F9FAFB', padding: '16px', borderRadius: '8px'}}>
                                <div className="response-box" style={{maxHeight: '150px'}}>{buildPrompt()}</div>
                            </div>

                            <button onClick={() => generate(true)} disabled={loading} className="btn-primary">
                                {loading ? '‚ü≥ Generando...' : '‚ú® Generar Mejorado'}
                            </button>

                            {resp2 && (
                                <>
                                    <div className="grid-2">
                                        <div style={{background: '#EFF6FF', padding: '16px', borderRadius: '8px'}}>
                                            <label className="label">Primera:</label>
                                            <div className="response-box" style={{fontSize: '12px', maxHeight: '200px'}}>{resp1}</div>
                                        </div>
                                        <div style={{background: '#F0FDF4', padding: '16px', borderRadius: '8px'}}>
                                            <label className="label">Mejorada:</label>
                                            <div className="response-box" style={{fontSize: '12px', maxHeight: '200px'}}>{resp2}</div>
                                        </div>
                                    </div>

                                    <div style={{background: '#F3F4F6', padding: '24px', borderRadius: '8px', border: '1px solid #9CA3AF'}}>
                                        <h3 style={{fontWeight: 700, color: '#374151', marginBottom: '16px'}}>üìù Reflexi√≥n Final</h3>
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <label className="label">¬øCu√°l logra mejor tu prop√≥sito?</label>
                                                <textarea value={finalRef.better} onChange={(e) => setFinalRef({...finalRef, better: e.target.value})}
                                                    className="textarea-field"></textarea>
                                            </div>
                                            <div>
                                                <label className="label">¬øCu√°l tiene el tono correcto?</label>
                                                <textarea value={finalRef.tone} onChange={(e) => setFinalRef({...finalRef, tone: e.target.value})}
                                                    className="textarea-field"></textarea>
                                            </div>
                                            <div>
                                                <label className="label">¬øQu√© cambio hizo la mayor mejora?</label>
                                                <textarea value={finalRef.bigChange} onChange={(e) => setFinalRef({...finalRef, bigChange: e.target.value})}
                                                    className="textarea-field"></textarea>
                                            </div>
                                            <div>
                                                <label className="label">¬øQu√© aprendiste?</label>
                                                <textarea value={finalRef.learning} onChange={(e) => setFinalRef({...finalRef, learning: e.target.value})}
                                                    className="textarea-field"></textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <div style={{background: '#F3F4F6', padding: '24px', borderRadius: '8px'}}>
    <h3 style={{fontWeight: 700, color: '#000000', marginBottom: '12px'}}>üéâ Puntos Clave</h3>
    <p style={{fontSize: '14px', color: '#000000', marginBottom: '4px'}}>‚úì Peque√±os cambios = grandes mejoras</p>
    <p style={{fontSize: '14px', color: '#000000', marginBottom: '4px'}}>‚úì La especificidad es clave</p>
    <p style={{fontSize: '14px', color: '#000000', marginBottom: '16px'}}>‚úì Los ejemplos son poderosos</p>
    
    <div style={{display: 'flex', gap: '8px', marginBottom: '12px'}}>
        <button onClick={exportData} className="btn-primary" style={{flex: 1}}>
            üìÑ Exportar TXT
        </button>
        <button onClick={exportToWord} className="btn-primary" style={{flex: 1}}>
            üìò Exportar Word
        </button>
    </div>
    
    <button 
        onClick={() => {
            if (window.confirm('¬øEst√°s seguro? Esto borrar√° todo tu progreso actual y volver√°s al inicio.')) {
                setStep(0);
                setData({
                    contentType: '', 
                    docSubtype: '',
                    presentationSubtype: '',
                    proposalSubtype: '',
                    socialSubtype: '',
                    topic: '', 
                    purpose: '', 
                    audience: '', 
                    tone: '', 
                    length: '',
                    format: '', 
                    examples: '', 
                    constraints: '',
                    keywords: '',
                    additionalInstructions: ''
                });
                setResp1('');
                setResp2('');
                setRef({ worked: '', notWorked: '', change: '' });
                setFinalRef({ better: '', tone: '', bigChange: '', learning: '' });
            }
        }}
        className="btn-secondary"
        style={{width: '100%'}}
    >
        üîÑ Empezar Nuevo Proyecto
    </button>
</div>
                                    </>
                            )}
                        </div>
                    )}
                </div>

                <div className="card">
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                        <button onClick={() => setStep(Math.max(0, step - 1))} disabled={step === 0} className="btn-secondary">
                            ‚Üê Atr√°s
                        </button>
                        <p style={{fontSize: '14px', color: '#8A8B8C'}}>Paso {step + 1} de 4</p>
                        <button onClick={() => setStep(Math.min(3, step + 1))} disabled={step === 3} className="btn-primary" style={{width: 'auto'}}>
                            Siguiente ‚Üí
                        </button>
                    </div>
                </div>

                <div style={{textAlign: 'center', padding: '20px', color: '#8A8B8C', fontSize: '14px'}}>
                    <a href="https://www.celestemartinez.net" target="_blank" rel="noopener noreferrer" style={{color: '#FF7A00', textDecoration: 'none', fontWeight: 600}}>
                        www.celestemartinez.net
                    </a>
                </div>
            </div>
        );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    <!-- Sistema de l√≠mites freemium -->
    <script src="js/limits.js"></script>
    <script src="js/modals.js"></script>
</body>
</html>
